<button onClick="listFiles()">Select Directory</button>

<ul id="carList"></ul>

<script type="text/javascript">
  var carList = document.getElementById("carList");
  
  async function addCar(carName, directoryHandle, entry) {

    var configNumber = getConfigNumber(entry.name);
    const fileHandle = await directoryHandle.getFileHandle(entry.name);
    const file = await fileHandle.getFile();
    await readContents(carName + configNumber, file);
    addCarListItem(carName, configNumber);
  }
  
  async function readContents(carName, file) {
    const contents = await file.text().split('\n');
    if(contents.length > 0) {
      contents.forEach(function(line) {
        if(line.indexOf("allowedPlaces") == 0) {
          var allowed = line.split("=")[1];
          console.log(`${carName} allowed in ${allowed}`);
        }
      });
    }
    // console.log(contents);
  }
                                        
  function addCarListItem(name, configNumber) {    
    const item = document.createElement("li");
    item.innerHtml = `${name}`;
    if(configNumber != null) item.innerHtml += configNumber;
    // console.log(`${name} ${configNumber}`);
    // checkboxes for each type
    carList.appendChild(item);
  }
  
  function getConfigNumber(name) {
    
    if(name.indexOf("config") != 0) return null;
    return name.replace("config", "").replace(".txt", "");
  }
  
  async function writeFile(fileHandle, contents) {
    // Create a FileSystemWritableFileStream to write to.
    const writable = await fileHandle.createWritable();
    // Write the contents of the file to the stream.
    await writable.write(contents);
    // Close the file and write the contents to disk.
    await writable.close();
  }
  
  async function listFiles() {
      const dirHandle = await window.showDirectoryPicker();
      for await (const entry of dirHandle.values()) {
        if(entry.kind == "directory") {
          var configCount = 0;
          var subDir = await dirHandle.getDirectoryHandle(entry.name);
          for await (const subEntry of subDir.values()) {
            if(subEntry.name.indexOf("config") == 0) await addCar(entry.name, subDir, subEntry);
            // if(subEntry.name.indexOf("config" == 0)) configCount++;
          }
          // addCar(entry.name, configCount);
        }
      // console.log(entry.kind, entry.name);
      }
  }
  
  listFiles();
</script>
